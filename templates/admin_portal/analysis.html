{% extends 'admin_portal/modern_base.html' %}
{% load static %}

{% block title %}Data Analysis{% endblock %}

{% block page_title %}Data Analysis{% endblock %}

{% block breadcrumbs %}
<li aria-current="page">
    <div class="flex items-center">
        <i class="fas fa-chevron-right text-gray-400 text-xs mx-1"></i>
        <span class="text-sm text-gray-500">Data Analysis</span>
    </div>
</li>
{% endblock %}

{% block content %}
<!-- Analysis Header -->
<div class="bg-white rounded-lg shadow mb-6">
    <div class="p-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h2 class="text-xl font-semibold text-gray-800">Data Analysis</h2>
                <p class="mt-1 text-sm text-gray-600">Analyze questionnaire responses and generate insights</p>
            </div>
            <div class="mt-4 md:mt-0 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                <button class="btn-animated inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <i class="fas fa-file-export mr-2"></i> Export Data
                </button>
                <button class="btn-animated inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <i class="fas fa-chart-line mr-2"></i> New Analysis
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Analysis Filters -->
<div class="bg-white rounded-lg shadow mb-6">
    <div class="p-5 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Analysis Filters</h3>
    </div>
    <div class="p-5">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label for="questionnaire" class="block text-sm font-medium text-gray-700 mb-1">Questionnaire</label>
                <select id="questionnaire" class="enhanced-select block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                    <option value="">All Questionnaires</option>
                    <option value="1">Depression Assessment (PHQ-9)</option>
                    <option value="2">Anxiety Screening (GAD-7)</option>
                    <option value="3">Stress Assessment (PSS-10)</option>
                    <option value="4">Sleep Quality Assessment</option>
                </select>
            </div>
            <div>
                <label for="date-range" class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                <select id="date-range" class="enhanced-select block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="365">Last year</option>
                    <option value="custom">Custom range</option>
                </select>
            </div>
            <div>
                <label for="organization" class="block text-sm font-medium text-gray-700 mb-1">Organization</label>
                <select id="organization" class="enhanced-select block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md">
                    <option value="">All Organizations</option>
                    <option value="1">General Hospital</option>
                    <option value="2">State University</option>
                    <option value="3">Mental Health Clinic</option>
                </select>
            </div>
        </div>
        <div class="mt-4 flex justify-end">
            <button class="btn-animated inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                <i class="fas fa-filter mr-2"></i> Apply Filters
            </button>
        </div>
    </div>
</div>

<!-- Analysis Overview -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
    <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-blue-50 mr-4">
                <i class="fas fa-clipboard-check text-blue-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Total Responses</p>
                <p class="text-2xl font-semibold text-gray-900">3,942</p>
            </div>
        </div>
        <div class="mt-4 flex items-center">
            <span class="text-sm font-medium text-green-600">+23.1%</span>
            <span class="text-sm text-gray-500 ml-2">from previous period</span>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-green-50 mr-4">
                <i class="fas fa-users text-green-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Unique Respondents</p>
                <p class="text-2xl font-semibold text-gray-900">1,284</p>
            </div>
        </div>
        <div class="mt-4 flex items-center">
            <span class="text-sm font-medium text-green-600">+12.5%</span>
            <span class="text-sm text-gray-500 ml-2">from previous period</span>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-purple-50 mr-4">
                <i class="fas fa-chart-pie text-purple-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Completion Rate</p>
                <p class="text-2xl font-semibold text-gray-900">78.3%</p>
            </div>
        </div>
        <div class="mt-4 flex items-center">
            <span class="text-sm font-medium text-green-600">+2.4%</span>
            <span class="text-sm text-gray-500 ml-2">from previous period</span>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-amber-50 mr-4">
                <i class="fas fa-clock text-amber-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Avg. Completion Time</p>
                <p class="text-2xl font-semibold text-gray-900">4:32</p>
            </div>
        </div>
        <div class="mt-4 flex items-center">
            <span class="text-sm font-medium text-red-600">+0:15</span>
            <span class="text-sm text-gray-500 ml-2">from previous period</span>
        </div>
    </div>
</div>

<!-- Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Response Trends Chart -->
    <div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200">
        <div class="p-5 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900 mb-2 sm:mb-0">Response Trends</h3>
                <div class="flex space-x-2">
                    <select class="text-sm border border-gray-300 rounded-md px-3 py-1 bg-white">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="p-5">
            <div class="h-80">
                <canvas id="responseTrendsChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Score Distribution Chart -->
    <div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200">
        <div class="p-5 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900 mb-2 sm:mb-0">Score Distribution</h3>
                <div class="flex space-x-2">
                    <select class="text-sm border border-gray-300 rounded-md px-3 py-1 bg-white">
                        <option value="1">Depression Assessment (PHQ-9)</option>
                        <option value="2" selected>Anxiety Screening (GAD-7)</option>
                        <option value="3">Stress Assessment (PSS-10)</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="p-5">
            <div class="h-80">
                <canvas id="scoreDistributionChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- More Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Demographics Chart -->
    <div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200">
        <div class="p-5 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900 mb-2 sm:mb-0">Demographics</h3>
                <div class="flex space-x-2">
                    <select class="text-sm border border-gray-300 rounded-md px-3 py-1 bg-white">
                        <option value="age" selected>Age Groups</option>
                        <option value="gender">Gender</option>
                        <option value="location">Location</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="p-5">
            <div class="h-80">
                <canvas id="demographicsChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Question Analysis Chart -->
    <div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200">
        <div class="p-5 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900 mb-2 sm:mb-0">Question Analysis</h3>
                <div class="flex space-x-2">
                    <select class="text-sm border border-gray-300 rounded-md px-3 py-1 bg-white">
                        <option value="1" selected>Depression Assessment (PHQ-9)</option>
                        <option value="2">Anxiety Screening (GAD-7)</option>
                        <option value="3">Stress Assessment (PSS-10)</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="p-5">
            <div class="h-80">
                <canvas id="questionAnalysisChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Recent Analysis Reports -->
<div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200 mb-6">
    <div class="p-5 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Recent Analysis Reports</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Report Name
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Questionnaire
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Date Range
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Created
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">Monthly Depression Trends</div>
                        <div class="text-xs text-gray-500">Automated report</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">Depression Assessment (PHQ-9)</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Apr 1, 2025 - Apr 30, 2025
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Apr 30, 2025
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button class="text-primary-600 hover:text-primary-900 transition-colors">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-gray-600 hover:text-gray-900 transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-900 transition-colors">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">Anxiety Score Analysis</div>
                        <div class="text-xs text-gray-500">Custom report</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">Anxiety Screening (GAD-7)</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Mar 15, 2025 - Apr 15, 2025
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Apr 16, 2025
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button class="text-primary-600 hover:text-primary-900 transition-colors">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-gray-600 hover:text-gray-900 transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-900 transition-colors">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">Stress Level Comparison</div>
                        <div class="text-xs text-gray-500">Custom report</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">Stress Assessment (PSS-10)</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Jan 1, 2025 - Apr 1, 2025
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Apr 5, 2025
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button class="text-primary-600 hover:text-primary-900 transition-colors">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-gray-600 hover:text-gray-900 transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-900 transition-colors">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="p-4 border-t border-gray-200 bg-white">
        <div class="flex justify-between items-center">
            <span class="text-sm text-gray-500">Showing 3 of 12 reports</span>
            <a href="#" class="text-sm text-primary-600 hover:text-primary-800 font-medium">View All Reports</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Response Trends Chart
        const responseTrendsCtx = document.getElementById('responseTrendsChart').getContext('2d');
        const responseTrendsChart = new Chart(responseTrendsCtx, {
            type: 'line',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                datasets: [
                    {
                        label: 'Depression Assessment',
                        data: [65, 72, 78, 85],
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Anxiety Screening',
                        data: [48, 56, 62, 70],
                        borderColor: 'rgba(139, 92, 246, 1)',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Stress Assessment',
                        data: [35, 42, 45, 52],
                        borderColor: 'rgba(239, 68, 68, 1)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Responses'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Time Period'
                        }
                    }
                }
            }
        });
        
        // Score Distribution Chart
        const scoreDistributionCtx = document.getElementById('scoreDistributionChart').getContext('2d');
        const scoreDistributionChart = new Chart(scoreDistributionCtx, {
            type: 'bar',
            data: {
                labels: ['0-4 (Minimal)', '5-9 (Mild)', '10-14 (Moderate)', '15-21 (Severe)'],
                datasets: [
                    {
                        label: 'Number of Respondents',
                        data: [120, 180, 85, 45],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.6)',
                            'rgba(234, 179, 8, 0.6)',
                            'rgba(249, 115, 22, 0.6)',
                            'rgba(239, 68, 68, 0.6)'
                        ],
                        borderColor: [
                            'rgba(34, 197, 94, 1)',
                            'rgba(234, 179, 8, 1)',
                            'rgba(249, 115, 22, 1)',
                            'rgba(239, 68, 68, 1)'
                        ],
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Respondents'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Score Range (Severity)'
                        }
                    }
                }
            }
        });
        
        // Demographics Chart
        const demographicsCtx = document.getElementById('demographicsChart').getContext('2d');
        const demographicsChart = new Chart(demographicsCtx, {
            type: 'pie',
            data: {
                labels: ['18-24', '25-34', '35-44', '45-54', '55-64', '65+'],
                datasets: [
                    {
                        data: [15, 30, 25, 18, 8, 4],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(139, 92, 246, 0.6)',
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(249, 115, 22, 0.6)',
                            'rgba(239, 68, 68, 0.6)',
                            'rgba(107, 114, 128, 0.6)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(139, 92, 246, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(249, 115, 22, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(107, 114, 128, 1)'
                        ],
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
        
        // Question Analysis Chart
        const questionAnalysisCtx = document.getElementById('questionAnalysisChart').getContext('2d');
        const questionAnalysisChart = new Chart(questionAnalysisCtx, {
            type: 'radar',
            data: {
                labels: ['Q1', 'Q2', 'Q3', 'Q4', 'Q5', 'Q6', 'Q7', 'Q8', 'Q9'],
                datasets: [
                    {
                        label: 'Average Score',
                        data: [1.8, 2.1, 1.5, 1.9, 2.3, 1.7, 1.2, 1.6, 2.0],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 3
                    }
                }
            }
        });
    });
</script>
{% endblock %}
